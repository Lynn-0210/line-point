function analyzeWithAI(base64) {
  const today = Utilities.formatDate(new Date(), "GMT+8", "yyyy/MM/dd");
  const keyword = "ä¸Šç·šé›†é»æ›ç¦®ç‰©";
  
  // ğŸ’¡ ä¿®æ­£é»ï¼šä½¿ç”¨æœ€ç©©å®šçš„ v1beta ç‰ˆæœ¬ï¼Œä¸¦ç¢ºä¿ç¶²å€çµå°¾æ²’æœ‰å¤šé¤˜çš„æ–œç·šæˆ–ç¬¦è™Ÿ
  const url = "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=" + GEMINI_API_KEY;
  
  const prompt = "ä½ æ˜¯ä¸€å€‹åš´æ ¼çš„é›†é»å¯©æ ¸å“¡ã€‚è«‹åˆ†æé€™å¼µåœ–ä¸¦æª¢æŸ¥ï¼š1. æ˜¯å¦åŒ…å«æ–‡å­—ã€Œ" + keyword + "ã€ã€‚2. æ˜¯å¦åŒ…å«æ—¥æœŸã€Œ" + today + "ã€ã€‚è‹¥ç¬¦åˆè«‹å›å‚³JSON: {\"ok\": true, \"points\": 1, \"items\": \"æˆåŠŸ\", \"reason\": \"\"} å¦å‰‡å›å‚³ {\"ok\": false, \"points\": 0, \"items\": \"\", \"reason\": \"ä¸ç¬¦è¦å‰‡\"}";

  const payload = {
    "contents": [{
      "parts": [
        { "text": prompt },
        { "inline_data": { "mime_type": "image/jpeg", "data": base64 } }
      ]
    }]
  };

  const options = {
    "method": "post",
    "contentType": "application/json",
    "payload": JSON.stringify(payload),
    "muteHttpExceptions": true
  };

  const res = UrlFetchApp.fetch(url, options);
  const resText = res.getContentText();
  const json = JSON.parse(resText);
  
  // æª¢æŸ¥ API æ˜¯å¦å ±éŒ¯
  if (json.error) {
    throw new Error("AI æœå‹™éŒ¯èª¤: " + json.error.message);
  }

  // å–å¾— AI å›å‚³çš„æ–‡å­—ä¸¦æ¸…ç†
  let aiText = json.candidates[0].content.parts[0].text;
  aiText = aiText.replace(/```json/g, '').replace(/```/g, '').trim();
  return JSON.parse(aiText);
}
